---
title: WPF中如何对TextBox输入内容进行校验
date: 2025-04-25 20:00:00 +0800
categories: [C#, WPF]
tags: [study]     # TAG names should always be lowercase
author: momochi
# authors: [xx,xx]
description: 介绍在WPF中如何校验TextBox输入内容，并提示错误
comments: true # 评论
pin: false # top 
math: true
---

## 自定义规则

命名空间:`System.Windows.Controls`\
程序集:`PresentationFramework.dll`

```c#
public abstract class ValidationRule
```

我们创建一个自定义的规则类来继承该抽象类，并重写相应的`Validate`方法。以下以输入最大最小值限制作为例子。

```c#
public class AgeRangeRule : ValidationRule
{
    public int Min { get; set; }
    public int Max { get; set; }
    
    public AgeRangeRule()
    {
    }

    public override ValidationResult Validate(object value, CultureInfo cultureInfo)
    {
        int age = 0;

        try
        {
            if (((string)value).Length > 0)
                age = Int32.Parse((String)value);
        }
        catch (Exception e)
        {
            return new ValidationResult(false, $"Illegal characters or {e.Message}");
        }

        if ((age < Min) || (age > Max))
        {
            return new ValidationResult(false,
              $"Please enter an age in the range: {Min}-{Max}.");
        }
        return ValidationResult.ValidResult;
    }
}
```

在xaml中如此:

```xaml
<TextBox Name="textBox1" Width="50" FontSize="15"
         Validation.ErrorTemplate="{StaticResource validationTemplate}"
         Style="{StaticResource textBoxInError}"
         Grid.Row="1" Grid.Column="1" Margin="2">
  <TextBox.Text>
    <Binding Path="Age" Source="{StaticResource ods}"
             UpdateSourceTrigger="PropertyChanged" >
      <Binding.ValidationRules>
        <local:AgeRangeRule Min="21" Max="130"/>
      </Binding.ValidationRules>
    </Binding>
  </TextBox.Text>
</TextBox>
```

即可指定`Min`和`Max`值。上面的`Validation.ErrorTemplate`指定了错误提示模板。

```xaml
<ControlTemplate x:Key="validationTemplate">
  <DockPanel>
    <TextBlock Foreground="Red" FontSize="20">!</TextBlock>
    <AdornedElementPlaceholder/>
  </DockPanel>
</ControlTemplate>
```

如此将会显示一个红色的感叹号。上面的`Style`属性中，也可以设置当出现错误时，显示错误信息。

```xaml
<Style x:Key="textBoxInError" TargetType="{x:Type TextBox}">
  <Style.Triggers>
    <Trigger Property="Validation.HasError" Value="true">
      <Setter Property="ToolTip"
              Value="{Binding RelativeSource={x:Static RelativeSource.Self},
                              Path=(Validation.Errors)[0].ErrorContent}"/>
    </Trigger>
  </Style.Triggers>
</Style>
```

## 数据绑定

上面的`Max`和`Min`都是固定在xaml中指定好的，但是有许多场景并不会固定这些传递给`ValidationRule`的值，需要使用绑定。但是这时就会发现`ValidationRule`子类不是`DependencyObject`导致无法直接使用`Binding`将其绑定。出现该情况，如果是新项目，则尽量使用ViewModel去实现`INotifyDataErrorInfo`。



