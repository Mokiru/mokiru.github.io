---
title: Doris基本介绍
date: 2025-04-06 03:00:00 +0800
categories: [Database, Doris]
tags: [study]     # TAG names should always be lowercase
author: momochi
# authors: [xx,xx]
description: Something of Doris
comments: true # 评论
pin: false # top 
math: true
---

## 简介

Doris是一款基于MPP架构的高性能、实时分析型数据库。以高效、简单和统一的特性著称。Doris既能支持高并发的点查询，也能支持高吞吐的复杂分析场景。因此Doris适合用于报表分析、即席查询、统一数仓构建、数据湖联邦查询加速等场景。用户可以基于Doris构建大屏看板、用户行为分析、AB实验平台、日志检索分析、用户画像分析、订单分析等应用。

Doris采用MySQL协议，兼容MySQL语法，支持标准SQL，用户可以通过各类客户端工具访问Doris，并支持与BI工具无缝集成，可以根据硬件环境与业务需求选择存算一体架构或存算分离架构。

总的来说Doris主要用来实时数据分析、交互式的OLAP分析、高并发点查询、数据湖联邦查询。优点有高性能、兼容MySQL协议、支持流式和批量的数据摄入，扩展性好。

## 数据模型

Doris目前支持三种表模型：
- 明细模型(Duplicate Key Model):允许指定的Key列重复，Doris存储层保留所有写入的数据，适用于必须保留所有原始数据记录的情况
- 主键模型(Unique Key Model):每一行的Key值唯一，可以确保给定的Key列不会存在重复行，Doris存储层对每个Key只保留最新写入的数据，适用于数据更新的情况
- 聚合模型(Aggregate Key Model):可根据Key列聚合数据，Doris存储层保留聚合后的数据，从而可以减少存储空间和提升查询性能；通常用于需要汇总或聚合信息（如总数或平均值）的情况

在建立表之后，表模型的属性已经确认，不能修改，因此针对不同业务选择相应合适的模型十分重要：
- **明细模型**：适合任意维度的Ad-hoc(临时查询，临时编写的可能缺少索引优化等的查询)。虽然同样无法利用预聚合的特性，但是不受聚合模型的约束，可以发挥列存模型的优势（只读取相关列，而不需要读取所有的Key列）
- **主键模型**：针对需要唯一主键约束的场景，可以保证主键唯一性约束，但是无法利用`ROLLUP`等预聚合带来的查询优势
- **聚合模型**：可以通过预聚合，极大地降低聚合查询时所需要扫描的数据里和查询的计算量，非常适合有固定模式的报表类查询场景，但是该模型对`count(*)`查询很不友好，同时因为固定了Value列上面的聚合方式，在进行其他类型的聚合查询时，需要考虑语意正确性
- 只有主键模型和聚合模型可以对部分列进行更新

### 明细模型

明细模型是Doris中的默认建表模型，用于保存每条原始数据记录，在建表时，通过`DUPLICATE KEY`指定数据存储的排序列，以优化常用查询，一般建议选择三列或更少的列作为排序键

明细模型具有以下特点：
- **保留原始数据**：明细模型保留了全量的原始数据，适合于存储与查询原始数据。对于需要进行详细数据分析的应用场景，建议使用明细模型，以避免数据丢失的风险
- **不去重也不聚合**：与聚合模型和主键模型不同，明细模型不会对数据进行去重与聚合操作，即使两条相同的数据，每次插入时也会被完整保留，相应的更新和删除操作在该模型是不建议的
- **灵活的数据查询**：明细模型保留了全量的原始数据，可以从完整数据中提取细节，基于全量数据做任意维度的聚合操作，从而进行原始数据的审计以及细粒度的分析

#### 使用场景

一般，明细模型中的数据只进行追加操作，旧数据不会更新，明细模型更适用于**需要存储全量原始数据的场景**：
- 日志存储：用于存储各类的程序操作日志，如访问日志、错误日志等，每一条数据都需要被详细记录，方便后续的审计和分析
- 用户行为数据：在分析用户行为时，如点击数据、用户访问轨迹等，需要保留用户的详细行为，方便后续构建用户画像及对行为路径进行详细分析
- 交易数据：在某些存储交易行为或订单数据时，交易结束一般不会发生数据变更。明细模型适合保留这一类交易信息，方便对交易进行精确地对账

#### 数据插入与存储

在明细表中，数据不进行去重与聚合，插入数据即存储数据，明细模型中Key列作为排序键

![Alt text](/assets/img/doris/duplicate.png)

